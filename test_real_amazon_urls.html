<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test URLs Reales de Amazon - BDD Productos</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold mb-6 text-center">üîó Test URLs REALES de Amazon</h1>
        <p class="text-center text-gray-300 mb-8">Productos espec√≠ficos de tu base de datos con enlaces reales a Amazon</p>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Test Haylou S35 ANC -->
            <div class="bg-gradient-to-br from-blue-900 to-blue-800 p-6 rounded-lg border border-blue-500">
                <h2 class="text-xl font-semibold mb-4 text-blue-200">üéß Haylou S35 ANC</h2>
                <div class="space-y-2 text-sm mb-4">
                    <p><strong>ID BDD:</strong> 1</p>
                    <p><strong>Precio BDD:</strong> $800 MXN</p>
                    <p><strong>Marca:</strong> Haylou</p>
                    <p><strong>Categor√≠a:</strong> Audifonos</p>
                </div>
                <button onclick="testProductUrls(1, 'Haylou S35 ANC')" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded transition-colors">
                    üîç Ver URLs Amazon
                </button>
                <div id="urls-1" class="mt-4 text-xs"></div>
            </div>
            
            <!-- Test Skullcandy Crusher -->
            <div class="bg-gradient-to-br from-orange-900 to-orange-800 p-6 rounded-lg border border-orange-500">
                <h2 class="text-xl font-semibold mb-4 text-orange-200">üî• Skullcandy Crusher ANC 2</h2>
                <div class="space-y-2 text-sm mb-4">
                    <p><strong>ID BDD:</strong> 2</p>
                    <p><strong>Precio BDD:</strong> $4000 MXN</p>
                    <p><strong>Marca:</strong> Skullcandy</p>
                    <p><strong>Categor√≠a:</strong> Audifonos</p>
                </div>
                <button onclick="testProductUrls(2, 'Skullcandy Crusher ANC 2')" class="w-full bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded transition-colors">
                    üîç Ver URLs Amazon
                </button>
                <div id="urls-2" class="mt-4 text-xs"></div>
            </div>
            
            <!-- Test Xiaomi Redmi Buds -->
            <div class="bg-gradient-to-br from-green-900 to-green-800 p-6 rounded-lg border border-green-500">
                <h2 class="text-xl font-semibold mb-4 text-green-200">üéµ Xiaomi Redmi Buds 6</h2>
                <div class="space-y-2 text-sm mb-4">
                    <p><strong>ID BDD:</strong> 3</p>
                    <p><strong>Precio BDD:</strong> $840 MXN</p>
                    <p><strong>Marca:</strong> Xiaomi</p>
                    <p><strong>Categor√≠a:</strong> Audifonos</p>
                </div>
                <button onclick="testProductUrls(3, 'Xiaomi Redmi Buds 6')" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded transition-colors">
                    üîç Ver URLs Amazon
                </button>
                <div id="urls-3" class="mt-4 text-xs"></div>
            </div>
        </div>
        
        <!-- √Årea de resultados detallados -->
        <div class="bg-gray-800 p-6 rounded-lg border border-gray-600">
            <h3 class="text-xl font-semibold mb-4 flex items-center">
                üîó URLs de Amazon Generadas (REALES)
                <span class="ml-2 px-2 py-1 bg-green-600 text-xs rounded-full">FUNCIONALES</span>
            </h3>
            <div id="detailed-results" class="space-y-6"></div>
        </div>
        
        <!-- Test de comparaci√≥n con URLs -->
        <div class="bg-purple-900 p-6 rounded-lg mt-6 border border-purple-500">
            <h3 class="text-lg font-semibold mb-4 text-purple-200">üÜö Test Comparaci√≥n con URLs Reales</h3>
            <p class="text-purple-300 mb-4">Simular comparaci√≥n y mostrar todos los enlaces de Amazon:</p>
            <div class="flex flex-wrap gap-4">
                <button onclick="testComparisonUrls(1, 2)" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded transition-colors">
                    Haylou vs Skullcandy
                </button>
                <button onclick="testComparisonUrls(2, 3)" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded transition-colors">
                    Skullcandy vs Xiaomi
                </button>
                <button onclick="testComparisonUrls(1, 3)" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded transition-colors">
                    Haylou vs Xiaomi
                </button>
                <button onclick="openAmazonMX()" class="bg-green-600 hover:bg-green-700 px-6 py-2 rounded transition-colors">
                    üá≤üáΩ Ver en Amazon MX
                </button>
            </div>
            <div id="comparison-urls" class="mt-6"></div>
        </div>
    </div>

    <script>
        async function testProductUrls(productId, productName) {
            const urlsDiv = document.getElementById(`urls-${productId}`);
            const detailedResults = document.getElementById('detailed-results');
            
            urlsDiv.innerHTML = '<div class="animate-pulse text-yellow-400">üîÑ Cargando URLs...</div>';
            
            try {
                const response = await fetch(`/amazon-for-product/${productId}`);
                const data = await response.json();
                
                if (data.success) {
                    const amazonProduct = data.amazon_results.data.products[0];
                    const dbProduct = data.db_product;
                    
                    // Mostrar URL principal en la tarjeta
                    urlsDiv.innerHTML = `
                        <div class="text-green-400 mb-2">‚úÖ URLs Generadas</div>
                        <a href="${amazonProduct.product_url}" target="_blank" 
                           class="text-blue-300 hover:text-blue-100 underline block mb-1 truncate" 
                           title="${amazonProduct.product_url}">
                            üîó B√∫squeda Principal
                        </a>
                        <div class="text-gray-400">Precio Amazon: ${amazonProduct.product_price}</div>
                    `;
                    
                    // Mostrar resultado detallado
                    const detailCard = document.createElement('div');
                    detailCard.className = 'border border-blue-500 p-4 rounded-lg bg-blue-900/20';
                    
                    const alternativeUrls = amazonProduct.alternative_urls || {};
                    let urlsHtml = '';
                    
                    // URL principal
                    urlsHtml += `
                        <div class="mb-3">
                            <h5 class="font-semibold text-blue-300 mb-2">üéØ URL Principal de B√∫squeda:</h5>
                            <a href="${amazonProduct.product_url}" target="_blank" 
                               class="text-blue-200 hover:text-blue-100 underline break-all text-sm">
                                ${amazonProduct.product_url}
                            </a>
                        </div>
                    `;
                    
                    // URLs alternativas
                    if (Object.keys(alternativeUrls).length > 0) {
                        urlsHtml += '<div class="mb-3"><h5 class="font-semibold text-green-300 mb-2">üîó URLs Alternativas:</h5>';
                        
                        for (const [key, url] of Object.entries(alternativeUrls)) {
                            const displayName = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            urlsHtml += `
                                <div class="mb-2">
                                    <strong class="text-green-200">${displayName}:</strong><br>
                                    <a href="${url}" target="_blank" 
                                       class="text-green-100 hover:text-green-50 underline break-all text-xs">
                                        ${url}
                                    </a>
                                </div>
                            `;
                        }
                        urlsHtml += '</div>';
                    }
                    
                    detailCard.innerHTML = `
                        <h4 class="font-bold text-blue-200 mb-3">üîó ${productName} - URLs de Amazon</h4>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-semibold text-gray-300 mb-2">üìä Datos BDD:</h5>
                                <div class="text-sm space-y-1">
                                    <div><strong>Nombre:</strong> ${dbProduct.name}</div>
                                    <div><strong>Marca:</strong> ${dbProduct.brand}</div>
                                    <div><strong>Precio MXN:</strong> $${dbProduct.price_mxn}</div>
                                    <div><strong>Modelo:</strong> ${dbProduct.model}</div>
                                </div>
                            </div>
                            <div>
                                <h5 class="font-semibold text-gray-300 mb-2">üõí Datos Amazon Mock:</h5>
                                <div class="text-sm space-y-1">
                                    <div><strong>Precio USD:</strong> ${amazonProduct.product_price}</div>
                                    <div><strong>Rating:</strong> ‚≠ê ${amazonProduct.product_star_rating} (${amazonProduct.product_num_ratings})</div>
                                    <div><strong>Prime:</strong> ${amazonProduct.is_prime ? '‚úÖ' : '‚ùå'}</div>
                                    <div class="text-green-200 font-medium">${amazonProduct._db_match}</div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            ${urlsHtml}
                        </div>
                        <div class="mt-3 p-2 bg-green-900/30 rounded text-xs text-green-200">
                            üí° <strong>Nota:</strong> Estas son URLs reales de b√∫squeda en Amazon. Al hacer clic, se abrir√° Amazon con los resultados de b√∫squeda para este producto espec√≠fico.
                        </div>
                    `;
                    
                    detailedResults.appendChild(detailCard);
                    
                } else {
                    urlsDiv.innerHTML = `<div class="text-red-400">‚ùå Error: ${data.error}</div>`;
                }
            } catch (error) {
                urlsDiv.innerHTML = `<div class="text-red-400">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        async function testComparisonUrls(id1, id2) {
            const resultDiv = document.getElementById('comparison-urls');
            
            resultDiv.innerHTML = '<div class="animate-pulse text-yellow-400">üîÑ Generando URLs para comparaci√≥n...</div>';
            
            try {
                const [product1Response, product2Response] = await Promise.all([
                    fetch(`/amazon-for-product/${id1}`),
                    fetch(`/amazon-for-product/${id2}`)
                ]);
                
                const product1Data = await product1Response.json();
                const product2Data = await product2Response.json();
                
                if (product1Data.success && product2Data.success) {
                    const p1 = product1Data.db_product;
                    const p2 = product2Data.db_product;
                    const a1 = product1Data.amazon_results.data.products[0];
                    const a2 = product2Data.amazon_results.data.products[0];
                    
                    resultDiv.innerHTML = `
                        <div class="border border-purple-300 p-6 rounded-lg bg-purple-900/30">
                            <h4 class="font-bold text-purple-200 mb-4">üÜö Comparaci√≥n de URLs: ${p1.name} vs ${p2.name}</h4>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="border-l-4 border-blue-500 pl-4">
                                    <h5 class="font-semibold text-blue-300 mb-3">${p1.name} (${p1.brand})</h5>
                                    <div class="space-y-2">
                                        <div class="text-sm">
                                            <strong>BDD:</strong> $${p1.price_mxn} MXN | 
                                            <strong>Amazon:</strong> ${a1.product_price}
                                        </div>
                                        <div>
                                            <strong class="text-blue-200">URL Principal:</strong><br>
                                            <a href="${a1.product_url}" target="_blank" 
                                               class="text-blue-100 hover:text-blue-50 underline text-xs break-all">
                                                ${a1.product_url}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border-l-4 border-orange-500 pl-4">
                                    <h5 class="font-semibold text-orange-300 mb-3">${p2.name} (${p2.brand})</h5>
                                    <div class="space-y-2">
                                        <div class="text-sm">
                                            <strong>BDD:</strong> $${p2.price_mxn} MXN | 
                                            <strong>Amazon:</strong> ${a2.product_price}
                                        </div>
                                        <div>
                                            <strong class="text-orange-200">URL Principal:</strong><br>
                                            <a href="${a2.product_url}" target="_blank" 
                                               class="text-orange-100 hover:text-orange-50 underline text-xs break-all">
                                                ${a2.product_url}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 flex flex-wrap gap-3">
                                <a href="${a1.product_url}" target="_blank" 
                                   class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm transition-colors">
                                    üîó Abrir ${p1.brand} en Amazon
                                </a>
                                <a href="${a2.product_url}" target="_blank" 
                                   class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded text-sm transition-colors">
                                    üîó Abrir ${p2.brand} en Amazon
                                </a>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div class="text-red-400">‚ùå Error en la comparaci√≥n de URLs</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-red-400">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        async function openAmazonMX() {
            // Abrir b√∫squeda gen√©rica en Amazon M√©xico
            const searchUrl = 'https://www.amazon.com.mx/s?k=audifonos+inalambricos+bluetooth&ref=sr_st_relevancerank';
            window.open(searchUrl, '_blank');
        }
        
        // Auto-test al cargar la p√°gina
        window.onload = function() {
            console.log('üöÄ Iniciando tests autom√°ticos de URLs reales...');
            setTimeout(() => testProductUrls(1, 'Haylou S35 ANC'), 500);
        };
    </script>
</body>
</html>