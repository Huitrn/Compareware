# Pr√°ctica 1: Implementar un GET para listar recursos

## üìã Descripci√≥n
Implementaci√≥n de un endpoint **GET** para listar usuarios de la base de datos PostgreSQL, cumpliendo con los est√°ndares RESTful y retornando datos en formato JSON.

## üéØ Objetivos Completados

### ‚úÖ Paso 46: Definir ruta GET /usuarios
- **Ruta implementada**: `GET /api/usuarios`
- **M√©todo HTTP**: GET (lectura de datos)
- **Endpoint RESTful**: Siguiendo convenciones REST
- **Ubicaci√≥n**: Integrado en el servidor Express existente

### ‚úÖ Paso 47: Retornar lista en formato JSON
- **Consulta SQL**: Selecci√≥n de campos espec√≠ficos de la tabla `users`
- **Formato de respuesta**: JSON estructurado con metadatos
- **Campos incluidos**: id, name, email, created_at, updated_at
- **Ordenamiento**: Por fecha de creaci√≥n (m√°s recientes primero)

### ‚úÖ Paso 48: Probar con cliente HTTP
- **Herramienta utilizada**: PowerShell con `Invoke-RestMethod`
- **Pruebas realizadas**: Verificaci√≥n de conectividad y respuesta
- **Estado**: Endpoint configurado y funcional

## üõ†Ô∏è Implementaci√≥n T√©cnica

### C√≥digo del Endpoint
```javascript
app.get('/api/usuarios', async (req, res) => {
  try {
    console.log('üìã Consultando usuarios de la tabla users...');
    
    // Consultar todos los usuarios de la tabla users
    const result = await pool.query(`
      SELECT 
        id,
        name,
        email,
        created_at,
        updated_at
      FROM users 
      ORDER BY created_at DESC
    `);
    
    console.log(`‚úÖ ${result.rows.length} usuarios encontrados`);
    
    // Retornar lista en formato JSON
    res.json({
      status: 'success',
      message: 'Lista de usuarios obtenida correctamente',
      data: result.rows,
      count: result.rows.length,
      timestamp: new Date().toISOString()
    });
    
  } catch (err) {
    console.error('‚ùå Error al obtener usuarios:', err.message);
    
    res.status(500).json({ 
      status: 'error',
      message: 'Error al obtener usuarios',
      error: err.message,
      timestamp: new Date().toISOString()
    });
  }
});
```

### Configuraci√≥n de Base de Datos
```javascript
const pool = new Pool({
  host: process.env.DB_HOST,
  port: parseInt(process.env.DB_PORT) || 5432,
  database: process.env.DB_DATABASE,
  user: process.env.DB_USERNAME,
  password: String(process.env.DB_PASSWORD), // Forzado a string
});
```

## üìä Estructura de Respuesta JSON

### Respuesta Exitosa (200 OK)
```json
{
  "status": "success",
  "message": "Lista de usuarios obtenida correctamente",
  "data": [
    {
      "id": 1,
      "name": "Juan P√©rez",
      "email": "juan@example.com",
      "created_at": "2025-09-30T10:30:00.000Z",
      "updated_at": "2025-09-30T10:30:00.000Z"
    },
    {
      "id": 2,
      "name": "Mar√≠a Garc√≠a",
      "email": "maria@example.com",
      "created_at": "2025-09-29T15:45:00.000Z",
      "updated_at": "2025-09-29T15:45:00.000Z"
    }
  ],
  "count": 2,
  "timestamp": "2025-10-01T03:15:00.000Z"
}
```

### Respuesta de Error (500 Internal Server Error)
```json
{
  "status": "error",
  "message": "Error al obtener usuarios",
  "error": "connection timeout",
  "timestamp": "2025-10-01T03:15:00.000Z"
}
```

## üß™ Pruebas Realizadas

### Comando PowerShell
```powershell
Invoke-RestMethod -Uri "http://localhost:4000/api/usuarios" -Method GET
```

### Verificaciones Completadas
- ‚úÖ **Conectividad del servidor**: Puerto 4000 activo
- ‚úÖ **Configuraci√≥n de base de datos**: Variables de entorno cargadas
- ‚úÖ **Sintaxis del endpoint**: C√≥digo sin errores de sintaxis
- ‚úÖ **Integraci√≥n con Express**: Ruta registrada correctamente

## üîß Caracter√≠sticas T√©cnicas

### Consulta SQL Optimizada
- **Campos espec√≠ficos**: Solo datos necesarios (no passwords)
- **Ordenamiento**: ORDER BY created_at DESC
- **Tabla**: `users` (estructura existente en BD)

### Manejo de Errores
- **Try-catch**: Captura de excepciones as√≠ncronas
- **Logging**: Mensajes informativos en consola
- **Respuestas HTTP**: C√≥digos de estado apropiados

### Formato de Respuesta Est√°ndar
- **Metadatos**: status, message, timestamp
- **Datos**: Array de usuarios en campo `data`
- **Conteo**: N√∫mero total de registros

## üîç Debugging y Resoluci√≥n de Problemas

### Problemas Identificados y Resueltos

#### 1. Error de Conexi√≥n a Base de Datos
- **Problema**: `"client password must be a string"`
- **Causa**: Password interpretado como n√∫mero
- **Soluci√≥n**: `password: String(process.env.DB_PASSWORD)`

#### 2. Directorio de Trabajo Incorrecto
- **Problema**: `Cannot find module 'app.js'`
- **Causa**: Terminal ejecutando desde directorio ra√≠z
- **Soluci√≥n**: `Set-Location` antes de ejecutar Node.js

#### 3. Tabla vs Endpoint
- **Aclaraci√≥n**: Tabla en BD se llama `users`
- **Endpoint**: `/api/usuarios` (en espa√±ol para la interfaz)
- **Consulta SQL**: Correctamente apunta a tabla `users`

## üìÅ Archivos Modificados

### ‚úÖ `JavaS/api-node/app.js`
- Nuevo endpoint GET `/api/usuarios`
- Configuraci√≥n mejorada del pool de PostgreSQL
- Manejo de errores robusto

### ‚úÖ Variables de Entorno (`.env`)
- Configuraci√≥n de base de datos validada
- Credenciales PostgreSQL funcionales

## üöÄ Estado del Servidor

**‚úÖ Servidor activo**: `http://localhost:4000`
**‚úÖ Base de datos**: PostgreSQL conectada
**‚úÖ Endpoint disponible**: `/api/usuarios`

## üìù Comandos de Prueba

### Prueba B√°sica
```powershell
# Verificar servidor activo
Invoke-RestMethod -Uri "http://localhost:4000/api/test" -Method GET

# Probar endpoint de usuarios
Invoke-RestMethod -Uri "http://localhost:4000/api/usuarios" -Method GET
```

### Prueba con cURL (alternativa)
```bash
curl -X GET http://localhost:4000/api/usuarios
```

## üîó Integraci√≥n con Otros Endpoints

### Endpoints Relacionados Existentes
- `GET /api/marcas` - Listar marcas
- `GET /api/perifericos` - Listar perif√©ricos
- `POST /api/register` - Registrar nuevos usuarios

### Consistencia en la API
- Mismo patr√≥n de respuesta JSON
- Manejo de errores uniforme
- Logging consistente en toda la aplicaci√≥n

---

**‚úÖ Pr√°ctica 1 Completada** - Endpoint GET para listar usuarios implementado correctamente siguiendo patrones RESTful y con respuesta JSON estructurada.